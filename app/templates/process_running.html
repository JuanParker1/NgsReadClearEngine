{% extends 'base.html' %}
{% block body %}
<meta http-equiv="Refresh" content="300">


<div id="main_screen" 
	 class="flex flex-col mx-auto  h-full justify-evenly items-center" 
	 style="background-color: {{gif['background']|safe}};">

	<h1 id="state_title" class="text-6xl text-center my-5 select-none" >{{text}}</h1>
	
	<div id="gif_div" class="w-1/3">
		<iframe src="https://giphy.com/embed/{{gif['gif_id']|safe}}" width="640" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/{{gif['gif_id']|safe}}">via GIPHY</a></p>
	</div>
	<!-- <img id="loading_gif" class="w-1/3" alt="loading page"/> -->

	<h3 class="text-2xl text-center my-5 select-none w-2/3">{{message_to_user}}</h3>
</div>

<script>
	//to listen for process updates
	const process_id = '{{process_id}}';
	let did_sent = false
	const eventSource = new EventSource("/stream/")
		eventSource.onmessage = function(e) {
		if (process_id === e.data){
			if (!did_sent){
				console.log(e)
				const http = new XMLHttpRequest();
				const url = '/remove_update/' + process_id;
				http.open('GET', url, true);

				//Send the proper header information along with the request
				http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				http.send();
				did_sent = true
			}
			window.location.reload();
		}
	}
		
	const main_screen = document.getElementById("main_screen");

	let corner_color = main_screen.style.backgroundColor.match(/\d+/g);

	let brightness = 0.34 * corner_color[0] + 0.5 * corner_color[1] + 0.16 * corner_color[2];

	if (brightness < 128) main_screen.style.color = "#FFFFFF";
	else main_screen.style.color = "#000000";

	
</script>

{% endblock %}



